<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail File PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      #toolbar {
        margin: 10px;
      }
      button {
        margin: 5px;
        padding: 5px 10px;
      }
      #pdfContainer {
        width: 100vw;
        height: 80vh;
        overflow: auto;
        border: 1px solid #ddd;
      }
      canvas {
        display: block;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <h2>File PDF Detail</h2>

    <div id="toolbar">
      <button id="prevPage">&#9665; Trang Trước</button>
      <span id="pageNum">1</span> / <span id="pageCount">1</span>
      <button id="nextPage">Trang Sau &#9655;</button>
      <button id="zoomIn">+</button>
      <button id="zoomOut">-</button>
      <a id="download" th:href="@{'/downloadFile/' + ${file.idFile}}">&#x2B07; Tải Xuống</a>
    </div>

    <div id="pdfContainer">
      <canvas id="pdfCanvas"></canvas>
    </div>

    <script>
      let pdfDoc = null,
        pageNum = 1,
        scale = 1.5;
      const canvas = document.getElementById("pdfCanvas");
      const ctx = canvas.getContext("2d");

      const url = /*[[${'/file/pdf/' + file.idFile}]]*/ "";

      pdfjsLib.getDocument(url).promise.then((pdf) => {
        pdfDoc = pdf;
        document.getElementById("pageCount").textContent = pdf.numPages;
        renderPage(pageNum);
      });

      function renderPage(num) {
        pdfDoc.getPage(num).then((page) => {
          const viewport = page.getViewport({ scale });
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          page.render({ canvasContext: ctx, viewport });
          document.getElementById("pageNum").textContent = num;
        });
      }

      document.getElementById("prevPage").addEventListener("click", () => {
        if (pageNum > 1) renderPage(--pageNum);
      });

      document.getElementById("nextPage").addEventListener("click", () => {
        if (pageNum < pdfDoc.numPages) renderPage(++pageNum);
      });

      document.getElementById("zoomIn").addEventListener("click", () => {
        scale += 0.2;
        renderPage(pageNum);
      });

      document.getElementById("zoomOut").addEventListener("click", () => {
        if (scale > 0.5) {
          scale -= 0.2;
          renderPage(pageNum);
        }
      });
    </script>
  </body>
</html>
